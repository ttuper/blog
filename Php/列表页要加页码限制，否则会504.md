#### 问题背景
千龙网首页改版后，网站首页采用的是纯静态页面，列表页用的是动态页，不过加了个伪静态，改版上线后多天，今天编辑反馈说频道页打不开了，于是，就开始着手排查原因，通过nginx日志发现大量请求频道列表页，且请求的页码也非常大，如下图所示：  
![异常请求](https://upload-images.jianshu.io/upload_images/9899281-f1f008d682f23cd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
可以看到前面的请求，例如：/sports/8268，请求8268就是体育频道下的第8268页。
按照正常用户来说，一般是不会请求到这么几千页的，除了爬虫相关。

由于这个频道列表页是动态页面，所以，那么多请求过来了，就会把php进程搞死，前面的php-fpm进程还没处理完，就堆积了那么多的请求，响应不过来自然就超时504了。

### 解决办法
1、如果页面是动态页的话，必须要在页面处加一层判断，判断请求页码如果大于100或者50，就返回false，直接不允许访问了。  
2、将动态页面静态化